{"ast":null,"code":"import MinorDialog from '../../components/M-Dialog.vue';\nimport api from '../../../api/index';\nexport default {\n  components: {\n    MinorDialog: MinorDialog\n  },\n\n  data() {\n    return {\n      add: {\n        visibleFlagAdd: false,\n        title: '添加客户',\n        width: '460px',\n        cradWidthHeight: 'width: 100%;',\n        showCard: {\n          one: false,\n          two: false,\n          three: false,\n          four: true\n        }\n      },\n      visibleFlag: false,\n      options: [{\n        value: 'mobile',\n        label: '手机号'\n      }, {\n        value: 'customerName',\n        label: '客户名'\n      }],\n      customerQuery: {\n        query: '',\n        pagenum: 1,\n        pagesize: 10,\n        value: 'mobile'\n      },\n      customerList: [],\n      total: 0,\n      addQuery: {\n        customerName: '',\n        mobile: '',\n        birthday: '',\n        channel: ''\n      },\n      rules: {\n        customerName: [{\n          required: true,\n          message: '请输入客户姓名',\n          trigger: 'blur'\n        }],\n        mobile: [{\n          required: true,\n          message: '请输入客户手机号',\n          trigger: 'blur'\n        }, {\n          min: 11,\n          max: 11,\n          message: '请输入11位手机号',\n          trigger: 'blur'\n        }],\n        channel: [{\n          required: true,\n          message: '请选择客户来源',\n          trigger: 'change'\n        }],\n        birthday: [{\n          type: 'date',\n          required: true,\n          message: '请选择客户生日',\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n\n  created() {\n    this.getCustomerList();\n  },\n\n  methods: {\n    showDialog() {\n      this.visibleFlag = true;\n    },\n\n    getType(val) {\n      this.customerQuery.value = val;\n    },\n\n    async getCustomerList() {\n      const {\n        data: res\n      } = await this.$axios.get(`${api.localUrl}/customerlist`, {\n        params: this.customerQuery\n      });\n      if (res.status !== 200) return this.$message.error('请求失败,请刷新重试');\n      this.customerList = res.data;\n      this.total = res.total;\n      console.log(res);\n    },\n\n    showCustomerDialog(customer) {\n      this.visibleFlag = true;\n    },\n\n    handleSizeChange(size) {\n      this.customerQuery.pagesize = size;\n      this.getCustomerList();\n    },\n\n    handleCurrentChange(curr) {\n      this.customerQuery.pagenum = curr;\n      this.getCustomerList();\n    },\n\n    getSele(val) {\n      console.log(val);\n    },\n\n    // 显示添加客户对话框\n    showAddCustomer() {\n      this.add.visibleFlagAdd = true;\n    },\n\n    // 添加客户\n    async AddCustomer() {\n      let becomeTime = new Date().getTime();\n      console.log(becomeTime);\n      becomeTime = becomeTime.toString().slice(0, 11);\n      console.log(becomeTime);\n      const {\n        data: res\n      } = await this.$axios.post(`${api.localUrl}/customerlist`, this.addQuery);\n      console.log(res);\n    },\n\n    // 删除客户\n    async removeCustomer(id) {\n      const {\n        data: res\n      } = await this.$axios.delete(`${api.localUrl}/customerlist/${id}`);\n      if (res.status !== 200) return this.$message.error('删除失败');\n      this.getCustomerList();\n    }\n\n  }\n};","map":{"version":3,"mappings":"AAyEA;AACA;AACA;EACAA;IACAC;EADA,CADA;;EAIAC;IACA;MACAC;QACAC,qBADA;QAEAC,aAFA;QAGAC,cAHA;QAIAC,+BAJA;QAKAC;UACAC,UADA;UAEAC,UAFA;UAGAC,YAHA;UAIAC;QAJA;MALA,CADA;MAaAC,kBAbA;MAcAC,UACA;QACAC,eADA;QAEAC;MAFA,CADA,EAKA;QACAD,qBADA;QAEAC;MAFA,CALA,CAdA;MAwBAC;QACAC,SADA;QAEAC,UAFA;QAGAC,YAHA;QAIAL;MAJA,CAxBA;MA8BAM,gBA9BA;MA+BAC,QA/BA;MAgCAC;QACAC,gBADA;QAEAC,UAFA;QAGAC,YAHA;QAIAC;MAJA,CAhCA;MAsCAC;QACAJ,eACA;UAAAK;UAAAC;UAAAC;QAAA,CADA,CADA;QAIAN,SACA;UAAAI;UAAAC;UAAAC;QAAA,CADA,EAEA;UAAAC;UAAAC;UAAAH;UAAAC;QAAA,CAFA,CAJA;QAQAJ,UACA;UAAAE;UAAAC;UAAAC;QAAA,CADA,CARA;QAWAL,WACA;UACAQ,YADA;UAEAL,cAFA;UAGAC,kBAHA;UAIAC;QAJA,CADA;MAXA;IAtCA;EA2DA,CAhEA;;EAiEAI;IACA;EACA,CAnEA;;EAoEAC;IACAC;MACA;IACA,CAHA;;IAIAC;MACA;IACA,CANA;;IAOA;MACA;QAAApC;MAAA,0BACA,8BADA,EAEA;QACAqC;MADA,CAFA;MAMA;MACA;MACA;MACAC;IACA,CAlBA;;IAmBAC;MACA;IACA,CArBA;;IAsBAC;MACA;MACA;IACA,CAzBA;;IA0BAC;MACA;MACA;IACA,CA7BA;;IA8BAC;MACAJ;IACA,CAhCA;;IAiCA;IACAK;MACA;IACA,CApCA;;IAqCA;IACA;MACA;MACAL;MACAM;MACAN;MACA;QAAAtC;MAAA,2BACA,8BADA,EAEA,aAFA;MAIAsC;IACA,CAhDA;;IAiDA;IACA;MACA;QAAAtC;MAAA,6BACA,oCADA;MAGA;MACA;IACA;;EAxDA;AApEA","names":["components","MinorDialog","data","add","visibleFlagAdd","title","width","cradWidthHeight","showCard","one","two","three","four","visibleFlag","options","value","label","customerQuery","query","pagenum","pagesize","customerList","total","addQuery","customerName","mobile","birthday","channel","rules","required","message","trigger","min","max","type","created","methods","showDialog","getType","params","console","showCustomerDialog","handleSizeChange","handleCurrentChange","getSele","showAddCustomer","becomeTime"],"sourceRoot":"src/views/customer","sources":["CustomerList.vue"],"sourcesContent":["<template>\n  <div>\n    <el-card>\n      <div class=\"order-top\">\n        <div>\n          <el-select v-model=\"customerQuery.value\" placeholder=\"请选择\" size=\"small\" @change=\"getType\">\n            <el-option v-for=\"item in options\" :key=\"item.value\" :label=\"item.label\" :value=\"item.value\">\n            </el-option>\n          </el-select>\n          <el-input placeholder=\"请输入搜索关键词\" v-model=\"customerQuery.query\" size=\"small\" clearable @clear=\"getCustomerList\">\n          </el-input>\n          <el-button type=\"primary\" size=\"small\" icon=\"el-icon-search\" @click=\"getCustomerList\">搜索</el-button>\n        </div>\n        <el-button type=\"primary\" size=\"small\" @click=\"showAddCustomer\">添加客户</el-button>\n      </div>\n      <!-- table区域 -->\n      <el-table :data=\"customerList\" @select=\"getSele\">\n        <el-table-column type=\"selection\"></el-table-column>\n        <el-table-column prop=\"customerName\" label=\"客户名称\"></el-table-column>\n        <el-table-column label=\"成为客户时间\">\n          <template slot-scope=\"scope\">\n            {{scope.row.becomeTime | transformTime}}\n          </template>\n        </el-table-column>\n        <el-table-column label=\"最近消费时间\">\n          <template slot-scope=\"scope\">\n            {{scope.row.consumeTime | transformTime}}\n          </template>\n        </el-table-column>\n        <el-table-column prop=\"customerBalance\" label=\"客户余额\"></el-table-column>\n        <el-table-column prop=\"consumeNum\" label=\"消费次数\"></el-table-column>\n        <el-table-column label=\"操作\">\n          <template slot-scope=\"scope\">\n            <el-button class=\"button-w\" type=\"primary\" @click=\"showCustomerDialog(scope.row)\" size=\"mini\">详情</el-button>\n            <el-popconfirm confirm-button-text='确认' cancel-button-text='取消' icon=\"el-icon-info\" icon-color=\"red\" title=\"确定删除该客户吗？\" @confirm=\"removeCustomer(scope.row.customerId)\">\n              <el-button slot=\"reference\" type=\"danger\" size=\"mini\">删除</el-button>\n            </el-popconfirm>\n          </template>\n        </el-table-column>\n      </el-table>\n      <!-- 分页 -->\n      <el-pagination background @size-change=\"handleSizeChange\" @current-change=\"handleCurrentChange\" :current-page=\"customerQuery.pagenum\" :page-sizes=\"[10, 20, 30, 40, 60]\" :page-size=\"customerQuery.pagesize\" layout=\"total, sizes, prev, pager, next, jumper\" :total=\"total\">\n      </el-pagination>\n    </el-card>\n    <MinorDialog :visibleFlag.sync=\"add.visibleFlagAdd\" :title=\"add.title\" :width=\"add.width\" :cradWidthHeight=\"add.cradWidthHeight\" :showCard=\"add.showCard\">\n      <el-form slot=\"four\" :model=\"addQuery\" label-width=\"84px\" size=\"mini\" class=\"add-form\" :rules=\"rules\">\n        <el-form-item label=\"姓名:\" prop=\"customerName\">\n          <el-input v-model=\"addQuery.customerName\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"手机号:\" prop=\"mobile\">\n          <el-input v-model=\"addQuery.mobile\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"客户来源:\" prop=\"channel\">\n          <el-select v-model=\"addQuery.channel\" placeholder=\"请选择客户来源\">\n            <el-option label=\"小红书\" value=\"小红书\"></el-option>\n            <el-option label=\"微信\" value=\"微信\"></el-option>\n            <el-option label=\"H5\" value=\"H5\"></el-option>\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"生日\" prop=\"birthday\">\n          <el-date-picker v-model=\"addQuery.birthday\" type=\"datetime\" placeholder=\"选择日期时间\" value-format=\"timestamp\">\n          </el-date-picker>\n        </el-form-item>\n        <div class=\"add-button\">\n          <el-button size=\"small\">取消</el-button>\n          <el-button type=\"primary\" size=\"small\" @click=\"AddCustomer\">确认</el-button>\n        </div>\n      </el-form>\n    </MinorDialog>\n  </div>\n</template>\n\n<script>\nimport MinorDialog from '../../components/M-Dialog.vue'\nimport api from '../../../api/index'\nexport default {\n  components: {\n    MinorDialog: MinorDialog,\n  },\n  data() {\n    return {\n      add: {\n        visibleFlagAdd: false,\n        title: '添加客户',\n        width: '460px',\n        cradWidthHeight: 'width: 100%;',\n        showCard: {\n          one: false,\n          two: false,\n          three: false,\n          four: true,\n        },\n      },\n      visibleFlag: false,\n      options: [\n        {\n          value: 'mobile',\n          label: '手机号',\n        },\n        {\n          value: 'customerName',\n          label: '客户名',\n        },\n      ],\n      customerQuery: {\n        query: '',\n        pagenum: 1,\n        pagesize: 10,\n        value: 'mobile',\n      },\n      customerList: [],\n      total: 0,\n      addQuery: {\n        customerName: '',\n        mobile: '',\n        birthday: '',\n        channel: '',\n      },\n      rules: {\n        customerName: [\n          { required: true, message: '请输入客户姓名', trigger: 'blur' },\n        ],\n        mobile: [\n          { required: true, message: '请输入客户手机号', trigger: 'blur' },\n          { min: 11, max: 11, message: '请输入11位手机号', trigger: 'blur' },\n        ],\n        channel: [\n          { required: true, message: '请选择客户来源', trigger: 'change' },\n        ],\n        birthday: [\n          {\n            type: 'date',\n            required: true,\n            message: '请选择客户生日',\n            trigger: 'blur',\n          },\n        ],\n      },\n    }\n  },\n  created() {\n    this.getCustomerList()\n  },\n  methods: {\n    showDialog() {\n      this.visibleFlag = true\n    },\n    getType(val) {\n      this.customerQuery.value = val\n    },\n    async getCustomerList() {\n      const { data: res } = await this.$axios.get(\n        `${api.localUrl}/customerlist`,\n        {\n          params: this.customerQuery,\n        }\n      )\n      if (res.status !== 200) return this.$message.error('请求失败,请刷新重试')\n      this.customerList = res.data\n      this.total = res.total\n      console.log(res)\n    },\n    showCustomerDialog(customer) {\n      this.visibleFlag = true\n    },\n    handleSizeChange(size) {\n      this.customerQuery.pagesize = size\n      this.getCustomerList()\n    },\n    handleCurrentChange(curr) {\n      this.customerQuery.pagenum = curr\n      this.getCustomerList()\n    },\n    getSele(val) {\n      console.log(val)\n    },\n    // 显示添加客户对话框\n    showAddCustomer() {\n      this.add.visibleFlagAdd = true\n    },\n    // 添加客户\n    async AddCustomer() {\n      let becomeTime = new Date().getTime()\n      console.log(becomeTime)\n      becomeTime = becomeTime.toString().slice(0, 11)\n      console.log(becomeTime)\n      const { data: res } = await this.$axios.post(\n        `${api.localUrl}/customerlist`,\n        this.addQuery\n      )\n      console.log(res)\n    },\n    // 删除客户\n    async removeCustomer(id) {\n      const { data: res } = await this.$axios.delete(\n        `${api.localUrl}/customerlist/${id}`\n      )\n      if (res.status !== 200) return this.$message.error('删除失败')\n      this.getCustomerList()\n    },\n  },\n}\n</script>\n\n<style lang=\"less\" scoped>\n.order-top {\n  display: flex;\n  justify-content: space-between;\n  margin-bottom: 18px;\n  .el-select {\n    width: 120px;\n    margin-right: 8px;\n  }\n  .el-input {\n    width: 284px;\n    margin-right: 4px;\n  }\n}\n.el-pagination {\n  margin-top: 16px;\n  display: flex;\n  justify-content: flex-start;\n}\n.button-w {\n  margin-right: 6px;\n}\n::v-deep .el-popconfirm__main {\n  margin-bottom: 6px;\n}\n::v-deep .detail-top {\n  margin-bottom: 0 !important;\n}\n.add-form {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  margin-top: 10px;\n  ::v-deep .el-input {\n    width: 240px;\n  }\n  .add-button {\n    margin-top: 10px;\n  }\n}\n</style>"]},"metadata":{},"sourceType":"module"}