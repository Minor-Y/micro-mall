{"ast":null,"code":"import axios from 'axios';\nimport api from '../../../api/index';\nimport { mapMutations, mapState } from 'vuex';\nexport default {\n  data() {\n    return {\n      resetPass: 'reset',\n      passForm: {\n        username: 'admin',\n        password: '123456'\n      },\n      verifyForm: {\n        vermobile: '',\n        vercode: ''\n      },\n      resetPassword: {\n        resmobile: '',\n        rescode: '',\n        respassword: ''\n      },\n      loginShow: 'pass',\n      register: 'login',\n      passRules: {\n        mobile: [{\n          required: true,\n          message: '请输入手机号',\n          trigger: 'blur'\n        }, {\n          min: 11,\n          max: 11,\n          message: '请输入11位手机号',\n          trigger: 'blur'\n        }],\n        password: [{\n          required: true,\n          message: '请输入密码',\n          trigger: 'blur'\n        }, {\n          min: 6,\n          max: 12,\n          message: '请输入6 - 12位密码',\n          trigger: 'blur'\n        }]\n      },\n      verifyRules: {\n        vermobile: [{\n          required: true,\n          message: '请输入手机号',\n          trigger: 'blur'\n        }, {\n          min: 11,\n          max: 11,\n          message: '请输入11位手机号',\n          trigger: 'blur'\n        }],\n        vercode: [{\n          required: true,\n          message: '请输入验证码',\n          trigger: 'blur'\n        }, {\n          min: 6,\n          max: 6,\n          message: '请输入6位数字验证码',\n          trigger: 'blur'\n        }]\n      },\n      resetRules: {\n        resmobile: [{\n          required: true,\n          message: '请输入手机号',\n          trigger: 'blur'\n        }, {\n          min: 11,\n          max: 11,\n          message: '请输入11位手机号',\n          trigger: 'blur'\n        }],\n        rescode: [{\n          required: true,\n          message: '请输入验证码',\n          trigger: 'blur'\n        }, {\n          min: 6,\n          max: 6,\n          message: '请输入6位数字验证码',\n          trigger: 'blur'\n        }],\n        respassword: [{\n          required: true,\n          message: '请输入需要设置的密码',\n          trigger: 'blur'\n        }, {\n          min: 6,\n          max: 12,\n          message: '请输入6 - 12位密码,包含数字和字母',\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n\n  computed: { ...mapState(['userId', 'menuRouterList'])\n  },\n  methods: { ...mapMutations(['setUserId', 'getUserId', 'setRouter']),\n\n    showPassword() {\n      console.log(this);\n      this.loginShow = 'pass';\n    },\n\n    showVerify() {\n      this.loginShow = 'verify';\n    },\n\n    showReset() {\n      this.register = 'reset';\n    },\n\n    showLogin() {\n      this.register = 'login';\n    },\n\n    // 确认按钮-密码登录验证\n    loginPassword() {\n      this.$refs.passRuleForm.validate(async valid => {\n        if (!valid) return this.$message.error('请检查账号密码是否填写正确');\n        const {\n          data: res\n        } = await axios.post(`${api.localUrl}/login`, this.passForm);\n        if (res.status !== 200) return this.$message.error('登录失败,请输入正确的账号或密码');\n        console.log(res);\n        window.sessionStorage.setItem('token', `Bearer ${res.data.authorization}`);\n        window.sessionStorage.setItem('tokenStart', new Date().getTime());\n        this.setUserId(res.data.userid); // 保存用户id到vuex中\n\n        this.getUserId();\n        const {\n          data: ress\n        } = await axios.get(`${api.localUrl}/menus`, {\n          params: {\n            userid: this.userId\n          }\n        });\n        if (ress.status !== 200) return this.$message.error('获取菜单失败'); // this.menuslist = ress.data\n\n        this.setRouter(ress.data); // 保存用户角色权限到vuex中\n\n        console.log('前端请求回来的角色权限', ress);\n        console.log('此时vuex里的角色权限', this.menuRouterList);\n        const aa = {\n          children: [{\n            path: '/dashboardover',\n            name: 'dashboardover',\n            meta: {\n              index: 2\n            },\n            component: () => import(\n            /* webpackChunkName: \"dashboardover\" */\n            '../dashboardover/Dashboardover.vue')\n          }]\n        };\n        let bb = []; // bb.push(JSON.stringify(aa.children[0]))\n\n        bb.push(toString(aa.children[0]));\n        console.log('bb', bb);\n        this.$message.success('登录成功');\n        this.$router.push('home');\n      });\n    },\n\n    // 验证码登录\n    loginVerify() {\n      this.$refs.verifyRuleForm.validate(async valid => {\n        if (!valid) return this.$message.error('请填写完整内容');\n        const {\n          data: res\n        } = await this.$axios.post('login-ver');\n        if (res.meta.status !== 200) return this.$message.error('登录失败,请输入正确的手机号或密码');\n        this.$message.success('登录成功');\n        this.$router.push('home');\n      });\n    }\n\n  }\n};","map":{"version":3,"mappings":"AAgFA;AACA;AACA;AACA;EACAA;IACA;MACAC,kBADA;MAEAC;QACAC,iBADA;QAEAC;MAFA,CAFA;MAMAC;QACAC,aADA;QAEAC;MAFA,CANA;MAUAC;QACAC,aADA;QAEAC,WAFA;QAGAC;MAHA,CAVA;MAeAC,iBAfA;MAgBAC,iBAhBA;MAiBAC;QACAC,SACA;UAAAC;UAAAC;UAAAC;QAAA,CADA,EAEA;UAAAC;UAAAC;UAAAH;UAAAC;QAAA,CAFA,CADA;QAKAd,WACA;UAAAY;UAAAC;UAAAC;QAAA,CADA,EAEA;UAAAC;UAAAC;UAAAH;UAAAC;QAAA,CAFA;MALA,CAjBA;MA2BAG;QACAf,YACA;UAAAU;UAAAC;UAAAC;QAAA,CADA,EAEA;UAAAC;UAAAC;UAAAH;UAAAC;QAAA,CAFA,CADA;QAKAX,UACA;UAAAS;UAAAC;UAAAC;QAAA,CADA,EAEA;UAAAC;UAAAC;UAAAH;UAAAC;QAAA,CAFA;MALA,CA3BA;MAqCAI;QACAb,YACA;UAAAO;UAAAC;UAAAC;QAAA,CADA,EAEA;UAAAC;UAAAC;UAAAH;UAAAC;QAAA,CAFA,CADA;QAKAR,UACA;UAAAM;UAAAC;UAAAC;QAAA,CADA,EAEA;UAAAC;UAAAC;UAAAH;UAAAC;QAAA,CAFA,CALA;QASAP,cACA;UAAAK;UAAAC;UAAAC;QAAA,CADA,EAEA;UACAC,MADA;UAEAC,OAFA;UAGAH,+BAHA;UAIAC;QAJA,CAFA;MATA;IArCA;EAyDA,CA3DA;;EA4DAK,YACA;EADA,CA5DA;EA+DAC,WACA,wDADA;;IAEAC;MACAC;MACA;IACA,CALA;;IAMAC;MACA;IACA,CARA;;IASAC;MACA;IACA,CAXA;;IAYAC;MACA;IACA,CAdA;;IAeA;IACAC;MACA;QACA;QACA;UAAA9B;QAAA,qBACA,uBADA,EAEA,aAFA;QAIA,wBACA;QACA0B;QACAK,8BACA,OADA,EAEA,kCAFA;QAIAA;QACA,gCAdA,CAcA;;QAEA;QACA;UAAA/B;QAAA;UACAgC;YAAAC;UAAA;QADA;QAGA,8DApBA,CAqBA;;QACA,0BAtBA,CAsBA;;QACAP;QACAA;QAEA;UACAQ,WACA;YACAC,sBADA;YAEAC,qBAFA;YAGAC;cAAAC;YAAA,CAHA;YAIAC,iBACA;YACA;YAAA,oCADA;UALA,CADA;QADA;QAaA,YAvCA,CAwCA;;QACAC;QACAd;QAEA;QACA;MACA,CA9CA;IA+CA,CAhEA;;IAiEA;IACAe;MACA;QACA;QACA;UAAAzC;QAAA;QACA,6BACA;QACA;QACA;MACA,CAPA;IAQA;;EA3EA;AA/DA","names":["data","resetPass","passForm","username","password","verifyForm","vermobile","vercode","resetPassword","resmobile","rescode","respassword","loginShow","register","passRules","mobile","required","message","trigger","min","max","verifyRules","resetRules","computed","methods","showPassword","console","showVerify","showReset","showLogin","loginPassword","window","params","userid","children","path","name","meta","index","component","bb","loginVerify"],"sourceRoot":"src/views/login","sources":["Login.vue"],"sourcesContent":["<template>\n  <div class=\"login\">\n    <div class=\"login-box\">\n      <img src=\"@/assets/JBLOGO.png\" alt=\"\">\n      <el-card v-if=\"register === 'login'\">\n        <el-row class=\"topcut\">\n          <el-col :span=\"7\" @click.native=\"showPassword\">密码登录</el-col>\n          <!-- <el-col :span=\"1\">|</el-col>\n          <el-col :span=\"16\" @click.native=\"showVerify\">验证码登录</el-col> -->\n        </el-row>\n\n        <!-- 密码登录区域 -->\n        <el-form :model=\"passForm\" v-if=\"register === 'login'\" :key=\"1\" :rules=\"passRules\" ref=\"passRuleForm\">\n          <el-form-item label=\"手机号码\" prop=\"username\">\n            <el-input v-model=\"passForm.username\" placeholder=\"请输入用户名\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"登录密码\" prop=\"password\">\n            <el-input v-model=\"passForm.password\" placeholder=\"请输入密码\"></el-input>\n          </el-form-item>\n          <el-row class=\"remember_forget\">\n            <el-col :span=\"12\" class=\"left\">\n              <el-checkbox label=\"记住我\"></el-checkbox>\n            </el-col>\n            <el-col :span=\"12\" class=\"right\">\n              <el-link :underline=\"false\" target=\"_blank\" @click=\"showReset\">忘记密码？</el-link>\n            </el-col>\n          </el-row>\n          <el-button type=\"primary\" @click=\"loginPassword\">登录</el-button>\n        </el-form>\n\n        <!-- 验证码登录区域 -->\n        <!-- <el-form :model=\"verifyForm\" v-else-if=\"loginShow === 'verify'\" :key=\"2\" :rules=\"verifyRules\" ref=\"verifyRuleForm\">\n          <el-form-item label=\"手机号码\" prop=\"vermobile\">\n            <el-input v-model=\"verifyForm.vermobile\" placeholder=\"注册时填写的手机号\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"验证码\" prop=\"vercode\">\n            <el-input v-model=\"verifyForm.vercode\" placeholder=\"请填写验证码\"></el-input>\n            <a href=\"\" class=\"getcode\">获取验证码</a>\n          </el-form-item>\n          <el-row class=\"remember_forget\">\n            <el-col :span=\"12\" class=\"left\">\n              <el-checkbox label=\"记住我\"></el-checkbox>\n            </el-col>\n          </el-row>\n          <el-button type=\"primary\" @click=\"loginVerify\">登录</el-button>\n        </el-form> -->\n      </el-card>\n      <!-- 密码重置区 -->\n      <el-card v-else-if=\"register === 'reset'\">\n        <el-row class=\"topcut\">\n          <el-col :span=\"24\" class=\"resetpass\">密码重置</el-col>\n        </el-row>\n        <!-- 密码重置区 -->\n        <el-form :model=\"resetPassword\" :rules=\"resetRules\" :key=\"3\">\n          <!-- 密码登录区域 -->\n          <el-form-item label=\"手机号码\" prop=\"resmobile\">\n            <el-input v-model=\"resetPassword.resmobile\" placeholder=\"注册时填写的手机号\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"验证码\" prop=\"rescode\">\n            <el-input v-model=\"resetPassword.rescode\" placeholder=\"请填写短信验证码\"></el-input>\n            <a href=\"\" class=\"getcode\">获取验证码</a>\n          </el-form-item>\n          <el-form-item label=\"设置密码\" prop=\"respassword\">\n            <el-input v-model=\"resetPassword.respassword\" placeholder=\"6-12位必须包含数字和字母\"></el-input>\n          </el-form-item>\n          <el-row>\n            <el-col :span=\"24\" class=\"left\">\n              <span>已有账号</span>\n              <el-link :underline=\"false\" type=\"primary\" target=\"_blank\" @click=\"showLogin\">登录</el-link>\n            </el-col>\n          </el-row>\n          <el-button type=\"primary\">确认修改</el-button>\n        </el-form>\n      </el-card>\n    </div>\n    <p>Copyright © 2022-2022 www.minorhan.com <a href=\"https://beian.miit.gov.cn/\" target=\"_blank\">浙ICP备2022023097号-1</a></p>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios'\nimport api from '../../../api/index'\nimport { mapMutations, mapState } from 'vuex'\nexport default {\n  data() {\n    return {\n      resetPass: 'reset',\n      passForm: {\n        username: 'admin',\n        password: '123456',\n      },\n      verifyForm: {\n        vermobile: '',\n        vercode: '',\n      },\n      resetPassword: {\n        resmobile: '',\n        rescode: '',\n        respassword: '',\n      },\n      loginShow: 'pass',\n      register: 'login',\n      passRules: {\n        mobile: [\n          { required: true, message: '请输入手机号', trigger: 'blur' },\n          { min: 11, max: 11, message: '请输入11位手机号', trigger: 'blur' },\n        ],\n        password: [\n          { required: true, message: '请输入密码', trigger: 'blur' },\n          { min: 6, max: 12, message: '请输入6 - 12位密码', trigger: 'blur' },\n        ],\n      },\n      verifyRules: {\n        vermobile: [\n          { required: true, message: '请输入手机号', trigger: 'blur' },\n          { min: 11, max: 11, message: '请输入11位手机号', trigger: 'blur' },\n        ],\n        vercode: [\n          { required: true, message: '请输入验证码', trigger: 'blur' },\n          { min: 6, max: 6, message: '请输入6位数字验证码', trigger: 'blur' },\n        ],\n      },\n      resetRules: {\n        resmobile: [\n          { required: true, message: '请输入手机号', trigger: 'blur' },\n          { min: 11, max: 11, message: '请输入11位手机号', trigger: 'blur' },\n        ],\n        rescode: [\n          { required: true, message: '请输入验证码', trigger: 'blur' },\n          { min: 6, max: 6, message: '请输入6位数字验证码', trigger: 'blur' },\n        ],\n        respassword: [\n          { required: true, message: '请输入需要设置的密码', trigger: 'blur' },\n          {\n            min: 6,\n            max: 12,\n            message: '请输入6 - 12位密码,包含数字和字母',\n            trigger: 'blur',\n          },\n        ],\n      },\n    }\n  },\n  computed: {\n    ...mapState(['userId', 'menuRouterList']),\n  },\n  methods: {\n    ...mapMutations(['setUserId', 'getUserId', 'setRouter']),\n    showPassword() {\n      console.log(this)\n      this.loginShow = 'pass'\n    },\n    showVerify() {\n      this.loginShow = 'verify'\n    },\n    showReset() {\n      this.register = 'reset'\n    },\n    showLogin() {\n      this.register = 'login'\n    },\n    // 确认按钮-密码登录验证\n    loginPassword() {\n      this.$refs.passRuleForm.validate(async (valid) => {\n        if (!valid) return this.$message.error('请检查账号密码是否填写正确')\n        const { data: res } = await axios.post(\n          `${api.localUrl}/login`,\n          this.passForm\n        )\n        if (res.status !== 200)\n          return this.$message.error('登录失败,请输入正确的账号或密码')\n        console.log(res)\n        window.sessionStorage.setItem(\n          'token',\n          `Bearer ${res.data.authorization}`\n        )\n        window.sessionStorage.setItem('tokenStart', new Date().getTime())\n        this.setUserId(res.data.userid) // 保存用户id到vuex中\n\n        this.getUserId()\n        const { data: ress } = await axios.get(`${api.localUrl}/menus`, {\n          params: { userid: this.userId },\n        })\n        if (ress.status !== 200) return this.$message.error('获取菜单失败')\n        // this.menuslist = ress.data\n        this.setRouter(ress.data) // 保存用户角色权限到vuex中\n        console.log('前端请求回来的角色权限', ress)\n        console.log('此时vuex里的角色权限', this.menuRouterList)\n\n        const aa = {\n          children: [\n            {\n              path: '/dashboardover',\n              name: 'dashboardover',\n              meta: { index: 2 },\n              component: () =>\n                import(\n                  /* webpackChunkName: \"dashboardover\" */ '../dashboardover/Dashboardover.vue'\n                ),\n            },\n          ],\n        }\n        let bb = []\n        // bb.push(JSON.stringify(aa.children[0]))\n        bb.push(toString(aa.children[0]))\n        console.log('bb',bb)\n\n        this.$message.success('登录成功')\n        this.$router.push('home')\n      })\n    },\n    // 验证码登录\n    loginVerify() {\n      this.$refs.verifyRuleForm.validate(async (valid) => {\n        if (!valid) return this.$message.error('请填写完整内容')\n        const { data: res } = await this.$axios.post('login-ver')\n        if (res.meta.status !== 200)\n          return this.$message.error('登录失败,请输入正确的手机号或密码')\n        this.$message.success('登录成功')\n        this.$router.push('home')\n      })\n    },\n  },\n}\n</script>\n\n<style lang=\"less\" scoped>\n.login {\n  width: 100%;\n  height: 100%;\n  min-height: 802px;\n  background-color: #f1f0f4;\n  .login-box {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    height: 100%;\n  }\n  p {\n    height: 24px;\n    margin-top: -32px;\n    color: #9797a1;\n    font-size: 12px;\n    a {\n      color: #9797a1;\n      text-decoration: none;\n    }\n  }\n}\nimg {\n  position: absolute;\n  // 按X轴移动118px,Y轴284px\n  transform: translate(-118px, -284px);\n}\n.el-card {\n  width: 400px;\n  height: 520px;\n  background-color: #fff;\n  border-radius: 8px;\n  box-shadow: 5px 10px 15px #e3e2e6;\n  box-sizing: border-box;\n  padding: 40px;\n}\n.topcut {\n  margin-bottom: 28px;\n  font-size: 20px;\n  font-weight: 500;\n  display: flex;\n  align-items: center;\n}\n::v-deep .el-card__body {\n  padding: 0;\n}\n::v-deep .el-col-7 {\n  display: flex;\n  justify-content: flex-start;\n  cursor: pointer;\n}\n::v-deep .el-col-1 {\n  display: flex;\n  justify-content: flex-start;\n  margin: 0 4px;\n  opacity: 0.2;\n}\n::v-deep .el-col-16 {\n  display: flex;\n  justify-content: flex-start;\n  cursor: pointer;\n}\n.resetpass {\n  display: flex;\n  justify-content: flex-start;\n}\n.el-form-item {\n  margin-bottom: 28px;\n}\n.remember_forget {\n  margin-top: 16px;\n  margin-bottom: 45px;\n}\n::v-deep .el-tabs__nav-wrap::after {\n  width: 0;\n  height: 0;\n}\n::v-deep .el-tabs__item {\n  padding: 0 5px;\n  font-size: 20px;\n}\n::v-deep .el-tabs__item:hover {\n  color: #303133;\n}\n::v-deep #tab-code {\n  opacity: 0.4;\n}\n::v-deep #tab-separator {\n  opacity: 0.2;\n}\n::v-deep .is-active {\n  color: #303133;\n}\n::v-deep .el-input__inner {\n  // border: 1px dotted solid double dashed #DCDFE6;\n  border-top-width: 0px;\n  border-left-width: 0px;\n  border-right-width: 0px;\n  border-bottom: 1px solid #dcdfe6;\n  border-radius: 0px;\n  padding: 0;\n}\n::v-deep .el-form-item__label {\n  font-weight: bold;\n  color: #000;\n  line-height: 26px;\n}\n::v-deep .el-tabs__header {\n  margin: 0 0 25px;\n}\n// 登录按钮\n.el-button {\n  width: 100%;\n  margin-top: 50px;\n  font-size: 16px;\n}\n.left {\n  text-align: left;\n  font-size: 14px;\n  display: flex;\n  line-height: 20px;\n}\n.right {\n  text-align: right;\n  font-size: 14px;\n  line-height: 20px;\n}\n// 获取验证码\n.getcode {\n  color: #2589ff;\n  position: absolute;\n  right: 0px;\n  text-decoration: none;\n}\n</style>"]},"metadata":{},"sourceType":"module"}