{"ast":null,"code":"import _Message2 from \"element-ui/lib/theme-chalk/message.css\";\nimport \"element-ui/lib/theme-chalk/base.css\";\nimport _Message from \"element-ui/lib/message\";\nimport Vue from 'vue';\nimport VueRouter from 'vue-router';\nimport store from '../store/index';\nimport _ from 'lodash';\nVue.use(VueRouter); // 解决ElementUI导航栏中的vue-router在3.0版本以上重复点菜单报错问题\n\nconst originalPush = VueRouter.prototype.push;\n\nVueRouter.prototype.push = function push(location) {\n  return originalPush.call(this, location).catch(err => err);\n}; // 固定路由\n\n\nconst constantRouterMap = [{\n  path: '/',\n  redirect: '/login'\n}, {\n  path: '/login',\n  name: 'login',\n  meta: {\n    index: 0\n  },\n  component: () => import(\n  /* webpackChunkName: \"login\" */\n  '../views/login/Login.vue')\n}, {\n  path: '/home',\n  name: 'home',\n  meta: {\n    index: 0\n  },\n  redirect: '/dashboardover',\n  component: () => import(\n  /* webpackChunkName: \"home\" */\n  '../views/home/Home.vue')\n}, {\n  path: '/404',\n  name: '404',\n  component: () => import(\n  /* webpackChunkName: \"home\" */\n  '../components/404.vue')\n}]; // 注册路由\n\nconst router = new VueRouter({\n  routes: constantRouterMap\n}); // 处理路由，生成路由格式数组\n\nconst disposeRouter = perss => {\n  const routerList = [];\n\n  if (perss) {\n    perss.forEach(menu => {\n      if (menu.childs) {\n        if (menu.component !== 'Layout') {\n          let mList = {\n            path: menu.path,\n            name: menu.path.split('/')[1],\n            meta: {\n              id: menu.id\n            },\n            component: resolve => require([`@/views/${menu.component}.vue`], resolve)\n          };\n          routerList.push(mList);\n        } else {\n          menu.childs.forEach(item => {\n            let rList = {\n              path: item.path,\n              name: item.path.split('/')[1],\n              meta: {\n                id: item.id\n              },\n              component: resolve => require([`@/views/${item.component}.vue`], resolve)\n            };\n            routerList.push(rList);\n          });\n        }\n      }\n    });\n  }\n\n  return routerList;\n};\n\nconst error404 = {\n  path: \"*\",\n  redirect: \"/404\",\n  hidden: true\n}; // 挂载路由守卫\n\nrouter.beforeEach((to, from, next) => {\n  // 获取token\n  let token = window.sessionStorage.getItem('token');\n  const tokenStart = window.sessionStorage.getItem('tokenStart');\n  const nowDate = new Date().getTime();\n  const timeOver = 3600 * 24 * 1000;\n\n  if (nowDate - tokenStart > timeOver) {\n    // 判断token是否过期\n    token = null;\n  }\n\n  if (token) {\n    // 判断token是否存在\n    if (to.path === '/login') {\n      next('/home');\n    } else {\n      if (router.getRoutes().length === 4) {\n        // 判断动态路由是否添加成功，未添加成功是只有无需权限的4个基本路由\n        try {\n          store.commit('getMenuRouterList'); // 保证vuex里有路由数据\n\n          const permiss = _.cloneDeep(store.state.menuRouterList);\n\n          const routerLists = disposeRouter(permiss); // 处理生成路由格式的路由数组\n\n          routerLists.forEach(item => {\n            router.addRoute('home', item);\n          });\n          router.addRoute(error404); // 在最后插入404路由\n\n          next({ ...to,\n            replace: true\n          });\n        } catch (err) {\n          console.log(err);\n        }\n      } else {\n        next();\n      }\n    }\n  } else {\n    if (to.path === '/login') {\n      next();\n    } else {\n      _Message.error('登录状态过期，请重新登录');\n\n      window.sessionStorage.clear();\n      next('/login');\n    }\n  }\n});\nexport default router;","map":{"version":3,"names":["Vue","VueRouter","store","_","use","originalPush","prototype","push","location","call","catch","err","constantRouterMap","path","redirect","name","meta","index","component","router","routes","disposeRouter","perss","routerList","forEach","menu","childs","mList","split","id","resolve","require","item","rList","error404","hidden","beforeEach","to","from","next","token","window","sessionStorage","getItem","tokenStart","nowDate","Date","getTime","timeOver","getRoutes","length","commit","permiss","cloneDeep","state","menuRouterList","routerLists","addRoute","replace","console","log","error","clear"],"sources":["/Users/minor/Documents/micro_mall/src/router/index.js"],"sourcesContent":["import Vue from 'vue'\nimport VueRouter from 'vue-router'\nimport { Message } from 'element-ui'\nimport store from '../store/index'\nimport _ from 'lodash'\n\nVue.use(VueRouter)\n\n// 解决ElementUI导航栏中的vue-router在3.0版本以上重复点菜单报错问题\nconst originalPush = VueRouter.prototype.push\nVueRouter.prototype.push = function push(location) {\n  return originalPush.call(this, location).catch(err => err)\n}\n// 固定路由\nconst constantRouterMap = [\n  {\n    path: '/',\n    redirect: '/login'\n  },\n  {\n    path: '/login',\n    name: 'login',\n    meta: { index: 0 },\n    component: () => import(/* webpackChunkName: \"login\" */ '../views/login/Login.vue')\n  },\n  {\n    path: '/home',\n    name: 'home',\n    meta: { index: 0 },\n    redirect: '/dashboardover',\n    component: () => import(/* webpackChunkName: \"home\" */ '../views/home/Home.vue'),\n  },\n  {\n    path: '/404',\n    name: '404',\n    component: () => import(/* webpackChunkName: \"home\" */ '../components/404.vue'),\n  },\n]\n\n// 注册路由\nconst router = new VueRouter({\n  routes: constantRouterMap\n})\n\n// 处理路由，生成路由格式数组\nconst disposeRouter = (perss) => {\n  const routerList = []\n  if (perss) {\n    perss.forEach((menu) => {\n      if (menu.childs) {\n        if (menu.component !== 'Layout') {\n          let mList = {\n            path: menu.path,\n            name: menu.path.split('/')[1],\n            meta: { id: menu.id },\n            component: resolve => require([`@/views/${menu.component}.vue`], resolve)\n          }\n          routerList.push(mList)\n        } else {\n          menu.childs.forEach(item => {\n            let rList = {\n              path: item.path,\n              name: item.path.split('/')[1],\n              meta: { id: item.id },\n              component: resolve => require([`@/views/${item.component}.vue`], resolve)\n            }\n            routerList.push(rList)\n          })\n        }\n\n      }\n    })\n  }\n  return routerList\n}\n\nconst error404 = { path: \"*\", redirect: \"/404\", hidden: true };\n\n// 挂载路由守卫\nrouter.beforeEach((to, from, next) => {\n  // 获取token\n  let token = window.sessionStorage.getItem('token')\n  const tokenStart = window.sessionStorage.getItem('tokenStart')\n  const nowDate = new Date().getTime()\n  const timeOver = 3600 * 24 * 1000\n  if (nowDate - tokenStart > timeOver) { // 判断token是否过期\n    token = null\n  }\n  if (token) { // 判断token是否存在\n    if (to.path === '/login') {\n      next('/home')\n    } else {\n      if (router.getRoutes().length === 4) { // 判断动态路由是否添加成功，未添加成功是只有无需权限的4个基本路由\n        try {\n          store.commit('getMenuRouterList') // 保证vuex里有路由数据\n          const permiss = _.cloneDeep(store.state.menuRouterList)\n          const routerLists = disposeRouter(permiss) // 处理生成路由格式的路由数组\n          routerLists.forEach((item) => {\n            router.addRoute('home', item)\n          })\n          router.addRoute(error404) // 在最后插入404路由\n          next({ ...to, replace: true })\n        } catch (err) {\n          console.log(err)\n        }\n      } else {\n        next()\n      }\n    }\n  } else {\n    if (to.path === '/login') {\n      next()\n    } else {\n      Message.error('登录状态过期，请重新登录')\n      window.sessionStorage.clear()\n      next('/login')\n    }\n  }\n})\n\nexport default router\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}