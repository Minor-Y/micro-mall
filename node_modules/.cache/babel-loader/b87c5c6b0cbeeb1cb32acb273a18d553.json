{"ast":null,"code":"import _Message2 from \"element-ui/lib/theme-chalk/message.css\";\nimport \"element-ui/lib/theme-chalk/base.css\";\nimport _Message from \"element-ui/lib/message\";\nimport Vue from 'vue';\nimport VueRouter from 'vue-router';\nimport store from '../store/index';\nimport _ from 'lodash';\nimport Customerlist from '@/views/customer/CustomerList.vue';\nVue.use(VueRouter); // 解决ElementUI导航栏中的vue-router在3.0版本以上重复点菜单报错问题\n\nconst originalPush = VueRouter.prototype.push;\n\nVueRouter.prototype.push = function push(location) {\n  return originalPush.call(this, location).catch(err => err);\n};\n\nconst constantRouterMap = [{\n  path: '/',\n  redirect: '/login'\n}, {\n  path: '/login',\n  name: 'login',\n  meta: {\n    index: 0\n  },\n  component: () => import(\n  /* webpackChunkName: \"login\" */\n  '../views/login/Login.vue')\n}, {\n  path: '/home',\n  name: 'home',\n  meta: {\n    index: 0\n  },\n  redirect: '/dashboardover',\n  component: () => import(\n  /* webpackChunkName: \"home\" */\n  '../views/home/Home.vue')\n}, {\n  path: '/404',\n  name: '404',\n  component: () => import(\n  /* webpackChunkName: \"home\" */\n  '../components/404.vue')\n}]; // 注册路由\n\nconst router = new VueRouter({\n  routes: constantRouterMap\n}); // 异步路由\n\nexport const asyncRouter = [// {\n//   path: '/home',\n//   name: 'home',\n//   meta: { index: 1 },\n//   redirect: '/dashboardover',\n//   component: () => import(/* webpackChunkName: \"home\" */ '../views/home/Home.vue'),\n//   children: [\n{\n  path: '/dashboardover',\n  name: 'dashboardover',\n  meta: {\n    index: 2\n  },\n  component: () => import(\n  /* webpackChunkName: \"dashboardover\" */\n  '../views/dashboardover/Dashboardover.vue')\n}, {\n  path: '/goodslist',\n  name: 'goodslist',\n  meta: {\n    index: 3\n  },\n  component: () => import(\n  /* webpackChunkName: \"goods\" */\n  '../views/goods/GoodsList.vue')\n}, {\n  path: '/orderlist',\n  name: 'orderlist',\n  meta: {\n    index: 4\n  },\n  component: () => import(\n  /* webpackChunkName: \"order\" */\n  '../views/order/OrderList.vue')\n}, {\n  path: '/customerlist',\n  name: 'customerlist',\n  meta: {\n    index: 5\n  },\n  component: Customerlist\n}, {\n  path: '/permissions',\n  name: 'permissions',\n  meta: {\n    index: 6\n  },\n  component: () => import(\n  /* webpackChunkName: \"set\" */\n  '../views/set/Permissions.vue')\n}]; // }\n// ]\n\nlet isDisposeRouter = 0; // 处理路由，生成路由格式数组\n\nconst disposeRouter = perss => {\n  const routerList = [];\n  perss.forEach(menu => {\n    if (menu.childs) {\n      if (menu.component !== 'Layout') {\n        let mList = {\n          path: menu.path,\n          name: menu.path.split('/')[1],\n          meta: {\n            id: menu.id\n          },\n          component: resolve => require([`@/views/${menu.component}.vue`], resolve)\n        };\n        routerList.push(mList);\n      } else {\n        menu.childs.forEach(item => {\n          let rList = {\n            path: item.path,\n            name: item.path.split('/')[1],\n            meta: {\n              id: item.id\n            },\n            component: resolve => require([`@/views/${item.component}.vue`], resolve)\n          };\n          routerList.push(rList);\n        });\n      }\n    }\n  });\n  console.log('打印下处理好的路由数组', routerList);\n  isDisposeRouter = 1;\n  return routerList;\n};\n\nconst error404 = {\n  path: \"*\",\n  redirect: \"/404\",\n  hidden: true\n}; // 挂载路由守卫\n\nrouter.beforeEach((to, from, next) => {\n  // 获取token\n  let token = window.sessionStorage.getItem('token');\n  const tokenStart = window.sessionStorage.getItem('tokenStart');\n  const nowDate = new Date().getTime();\n  const timeOver = 3600 * 24 * 1000;\n\n  if (nowDate - tokenStart > timeOver) {\n    // 判断token是否过期\n    token = null;\n  }\n\n  if (token) {\n    // 判断token是否存在\n    if (to.path === '/login') {\n      next('/home');\n    } else {\n      if (router.getRoutes().length === 4) {\n        // 判断动态路由是否添加成功，未添加成功是只有无需权限的4个基本路由\n        console.log('现在的vuex路由列表', store.state.menuRouterList);\n\n        try {\n          store.commit('getMenuRouterList'); // 保证vuex里有路由数据\n\n          const permiss = _.cloneDeep(store.state.menuRouterList);\n\n          console.log('permiss', permiss);\n          const routerLists = disposeRouter(permiss); // 处理生成路由格式的路由数组\n          // routerLists.push(error404)\n\n          routerLists.forEach(item => {\n            router.addRoute('home', item);\n          });\n          router.addRoute(error404);\n          console.log(\"路由添加后\", router.getRoutes());\n          next({ ...to,\n            replace: true\n          });\n        } catch (err) {\n          console.log(err);\n        }\n      } else {\n        next();\n      }\n    }\n  } else {\n    if (to.path === '/login') {\n      next();\n    } else {\n      _Message.error('登录状态过期，请重新登录');\n\n      window.sessionStorage.clear();\n      next('/login');\n    }\n  }\n});\nexport default router;","map":{"version":3,"names":["Vue","VueRouter","store","_","Customerlist","use","originalPush","prototype","push","location","call","catch","err","constantRouterMap","path","redirect","name","meta","index","component","router","routes","asyncRouter","isDisposeRouter","disposeRouter","perss","routerList","forEach","menu","childs","mList","split","id","resolve","require","item","rList","console","log","error404","hidden","beforeEach","to","from","next","token","window","sessionStorage","getItem","tokenStart","nowDate","Date","getTime","timeOver","getRoutes","length","state","menuRouterList","commit","permiss","cloneDeep","routerLists","addRoute","replace","error","clear"],"sources":["/Users/minor/Documents/micro_mall/src/router/index.js"],"sourcesContent":["import Vue from 'vue'\nimport VueRouter from 'vue-router'\nimport { Message } from 'element-ui'\nimport store from '../store/index'\nimport _ from 'lodash'\n\nimport Customerlist from '@/views/customer/CustomerList.vue'\n\nVue.use(VueRouter)\n\n// 解决ElementUI导航栏中的vue-router在3.0版本以上重复点菜单报错问题\nconst originalPush = VueRouter.prototype.push\nVueRouter.prototype.push = function push(location) {\n  return originalPush.call(this, location).catch(err => err)\n}\n\nconst constantRouterMap = [\n  {\n    path: '/',\n    redirect: '/login'\n  },\n  {\n    path: '/login',\n    name: 'login',\n    meta: { index: 0 },\n    component: () => import(/* webpackChunkName: \"login\" */ '../views/login/Login.vue')\n  },\n  {\n    path: '/home',\n    name: 'home',\n    meta: { index: 0 },\n    redirect: '/dashboardover',\n    component: () => import(/* webpackChunkName: \"home\" */ '../views/home/Home.vue'),\n  },\n  {\n    path: '/404',\n    name: '404',\n    component: () => import(/* webpackChunkName: \"home\" */ '../components/404.vue'),\n  },\n]\n\n// 注册路由\nconst router = new VueRouter({\n  routes: constantRouterMap\n})\n\n// 异步路由\nexport const asyncRouter = [\n  // {\n  //   path: '/home',\n  //   name: 'home',\n  //   meta: { index: 1 },\n  //   redirect: '/dashboardover',\n  //   component: () => import(/* webpackChunkName: \"home\" */ '../views/home/Home.vue'),\n  //   children: [\n  {\n    path: '/dashboardover',\n    name: 'dashboardover',\n    meta: { index: 2 },\n    component: () => import(/* webpackChunkName: \"dashboardover\" */ '../views/dashboardover/Dashboardover.vue'),\n  },\n  {\n    path: '/goodslist',\n    name: 'goodslist',\n    meta: { index: 3 },\n    component: () => import(/* webpackChunkName: \"goods\" */ '../views/goods/GoodsList.vue'),\n  },\n  {\n    path: '/orderlist',\n    name: 'orderlist',\n    meta: { index: 4 },\n    component: () => import(/* webpackChunkName: \"order\" */ '../views/order/OrderList.vue'),\n  },\n  {\n    path: '/customerlist',\n    name: 'customerlist',\n    meta: { index: 5 },\n    component: Customerlist\n  },\n  {\n    path: '/permissions',\n    name: 'permissions',\n    meta: { index: 6 },\n    component: () => import(/* webpackChunkName: \"set\" */ '../views/set/Permissions.vue'),\n  },\n]\n// }\n// ]\n\n\nlet isDisposeRouter = 0\n// 处理路由，生成路由格式数组\nconst disposeRouter = (perss) => {\n  const routerList = []\n  perss.forEach((menu) => {\n    if (menu.childs) {\n      if (menu.component !== 'Layout') {\n        let mList = {\n          path: menu.path,\n          name: menu.path.split('/')[1],\n          meta: { id: menu.id },\n          component: resolve => require([`@/views/${menu.component}.vue`], resolve)\n        }\n        routerList.push(mList)\n      } else {\n        menu.childs.forEach(item => {\n          let rList = {\n            path: item.path,\n            name: item.path.split('/')[1],\n            meta: { id: item.id },\n            component: resolve => require([`@/views/${item.component}.vue`], resolve)\n          }\n          routerList.push(rList)\n        })\n      }\n\n    }\n  })\n  console.log('打印下处理好的路由数组', routerList)\n  isDisposeRouter = 1\n  return routerList\n}\n\nconst error404 = { path: \"*\", redirect: \"/404\", hidden: true };\n\n// 挂载路由守卫\nrouter.beforeEach((to, from, next) => {\n  // 获取token\n  let token = window.sessionStorage.getItem('token')\n  const tokenStart = window.sessionStorage.getItem('tokenStart')\n  const nowDate = new Date().getTime()\n  const timeOver = 3600 * 24 * 1000\n  if (nowDate - tokenStart > timeOver) { // 判断token是否过期\n    token = null\n  }\n  if (token) { // 判断token是否存在\n    if (to.path === '/login') {\n      next('/home')\n    } else {\n      if (router.getRoutes().length === 4) { // 判断动态路由是否添加成功，未添加成功是只有无需权限的4个基本路由\n        console.log('现在的vuex路由列表', store.state.menuRouterList)\n          try {\n            store.commit('getMenuRouterList') // 保证vuex里有路由数据\n            const permiss = _.cloneDeep(store.state.menuRouterList)\n            console.log('permiss', permiss)\n            const routerLists = disposeRouter(permiss) // 处理生成路由格式的路由数组\n            // routerLists.push(error404)\n            routerLists.forEach((item) => {\n              router.addRoute('home', item)\n            })\n            router.addRoute(error404)\n            console.log(\"路由添加后\", router.getRoutes())\n            next({ ...to, replace: true })\n          } catch (err) {\n            console.log(err)\n          }\n      } else {\n        next()\n      }\n    }\n  } else {\n    if (to.path === '/login') {\n      next()\n    } else {\n      Message.error('登录状态过期，请重新登录')\n      window.sessionStorage.clear()\n      next('/login')\n    }\n  }\n})\n\nexport default router\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}